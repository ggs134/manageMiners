{% extends "layout.html" %}

{% block body %}



    <div class="container-fluid">
      <div class="row">
        <!-- <div class="col-sm-3 col-md-2 sidebar">
          <ul class="nav nav-sidebar">
            <li class="active"><a href="http://onther.iptime.org:5000#">Overview <span class="sr-only">(current)</span></a></li>
            <li><a href="http://onther.iptime.org:5000#">Reports</a></li>
            <li><a href="http://onther.iptime.org:5000#">Analytics</a></li>
            <li><a href="http://onther.iptime.org:5000#">Export</a></li>
          </ul>
          <ul class="nav nav-sidebar">
            <li><a href="http://onther.iptime.org:5000#">Nav item</a></li>
            <li><a href="http://onther.iptime.org:5000#">Nav item again</a></li>
            <li><a href="http://onther.iptime.org:5000#">One more nav</a></li>
            <li><a href="http://onther.iptime.org:5000#">Another nav item</a></li>
            <li><a href="http://onther.iptime.org:5000#">More navigation</a></li>
          </ul>
          <ul class="nav nav-sidebar">
            <li><a href="http://onther.iptime.org:5000#">Nav item again</a></li>
            <li><a href="http://onther.iptime.org:5000#">One more nav</a></li>
            <li><a href="http://onther.iptime.org:5000#">Another nav item</a></li>
          </ul>
        </div> -->
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
          <!-- <div class="row placeholders"> -->
            <h1 class="page-header">골드러시 대시보드</h1>
          <!-- </div> -->

          <div class="row placeholders">
            <div class="col-xs-6 col-sm-3 placeholder">
              <!-- <img data-src="holder.js/200x200/auto/sky?text=Hello" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9InllcyI/PjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiPjxkZWZzLz48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzBEOEZEQiIvPjxnPjx0ZXh0IHg9Ijc0LjA1NDY4NzUiIHk9IjEwMCIgc3R5bGU9ImZpbGw6I0ZGRkZGRjtmb250LXdlaWdodDpib2xkO2ZvbnQtZmFtaWx5OkFyaWFsLCBIZWx2ZXRpY2EsIE9wZW4gU2Fucywgc2Fucy1zZXJpZiwgbW9ub3NwYWNlO2ZvbnQtc2l6ZToxMHB0O2RvbWluYW50LWJhc2VsaW5lOmNlbnRyYWwiPjIwMHgyMDA8L3RleHQ+PC9nPjwvc3ZnPg=="> -->
              <!-- <img data-src="holder.js/200x200/auto/sky"> -->
              <h2 id="total-machines">가동장비</h2>
              <span class="text-muted">가동장비</span>
            </div>
            <div class="col-xs-6 col-sm-3 placeholder">
              <!-- <img data-src="holder.js/200x200/auto/vine" class="img-responsive" alt="200x200" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9InllcyI/PjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiPjxkZWZzLz48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzM5REJBQyIvPjxnPjx0ZXh0IHg9Ijc0LjA1NDY4NzUiIHk9IjEwMCIgc3R5bGU9ImZpbGw6IzFFMjkyQztmb250LXdlaWdodDpib2xkO2ZvbnQtZmFtaWx5OkFyaWFsLCBIZWx2ZXRpY2EsIE9wZW4gU2Fucywgc2Fucy1zZXJpZiwgbW9ub3NwYWNlO2ZvbnQtc2l6ZToxMHB0O2RvbWluYW50LWJhc2VsaW5lOmNlbnRyYWwiPjIwMHgyMDA8L3RleHQ+PC9nPjwvc3ZnPg==" data-holder-rendered="true"> -->
              <h2 id="total-hash">총해시량</h2>
              <span class="text-muted">총해시량</span>
            </div>
            <div class="col-xs-6 col-sm-3 placeholder">
              <!-- <img data-src="holder.js/200x200/auto/sky" class="img-responsive" alt="200x200" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9InllcyI/PjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiPjxkZWZzLz48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzBEOEZEQiIvPjxnPjx0ZXh0IHg9Ijc0LjA1NDY4NzUiIHk9IjEwMCIgc3R5bGU9ImZpbGw6I0ZGRkZGRjtmb250LXdlaWdodDpib2xkO2ZvbnQtZmFtaWx5OkFyaWFsLCBIZWx2ZXRpY2EsIE9wZW4gU2Fucywgc2Fucy1zZXJpZiwgbW9ub3NwYWNlO2ZvbnQtc2l6ZToxMHB0O2RvbWluYW50LWJhc2VsaW5lOmNlbnRyYWwiPjIwMHgyMDA8L3RleHQ+PC9nPjwvc3ZnPg==" data-holder-rendered="true"> -->
              <h2>{{lastMined | round(3)}} Ether</h2>
              <span class="text-muted">지난3시간채굴량</span>
            </div>
            <div class="col-xs-6 col-sm-3 placeholder">
              <!-- <img data-src="holder.js/200x200/auto/vine" class="img-responsive" alt="200x200" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9InllcyI/PjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiPjxkZWZzLz48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzM5REJBQyIvPjxnPjx0ZXh0IHg9Ijc0LjA1NDY4NzUiIHk9IjEwMCIgc3R5bGU9ImZpbGw6IzFFMjkyQztmb250LXdlaWdodDpib2xkO2ZvbnQtZmFtaWx5OkFyaWFsLCBIZWx2ZXRpY2EsIE9wZW4gU2Fucywgc2Fucy1zZXJpZiwgbW9ub3NwYWNlO2ZvbnQtc2l6ZToxMHB0O2RvbWluYW50LWJhc2VsaW5lOmNlbnRyYWwiPjIwMHgyMDA8L3RleHQ+PC9nPjwvc3ZnPg==" data-holder-rendered="true"> -->
              <h2>{{(lastMined*8) | round(2)}} Ether</h2>
              <span class="text-muted">1일예상수입(ETH)</span>
            </div>
          </div>

          <h2 class="sub-header">마이닝정보</h2>
          <div class="table-responsive">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>마이너번호</th>
                  <th>이더리움해시값</th>
                  <th>클래식해시값</th>
                  <th>재부팅</th>
                  <!-- th>온도1</th>
                  <th>온도2</th>
                  <th>온도3</th>
                  <th>온도4</th>
                  <th>온도5</th>
                  <th>온도6</th> -->
                </tr>
              </thead>
              <tbody>
                {% for num in machines %}
                <tr class={{num}}>
                  <td id="miner{{num}}">{{num}}</td>
                  <td id="hash{{num}}"></td>
                  <td id="hashC{{num}}"></td>
                  <td>버튼(예정)</td>
                  <!-- <td id='gpu{{num}}1'></td>
                  <td id='gpu{{num}}2'></td>
                  <td id='gpu{{num}}3'></td>
                  <td id='gpu{{num}}4'></td>
                  <td id='gpu{{num}}5'></td>
                  <td id='gpu{{num}}6'></td> -->
                </tr>
                {% endfor %}
              </tbody>
            </table>
            <!-- <div id="log">hi</div> -->
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="{{url_for('static', filename='jquery.min.js')}}" ></script>
    <script src="{{url_for('static', filename='bootstrap.min.js')}}" ></script>
    <!-- Just to make our placeholder images work. Don't actually copy the next line! -->
    <script src="{{url_for('static', filename='holder.js')}}" ></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="{{url_for('static', filename='ie10-viewport-bug-workaround.js')}}" ></script>
    <!-- socketio  -->
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>

    <script type="text/javascript" charset="utf-8">
      $(document).ready(function(){
        namespace = '/jsh';
        // tailScroll();
        var socket = io.connect('http://' + document.domain + ':' + location.port + namespace);
        // socket.on('connect', function() {
        //     socket.emit('my event', {data: 'I\'m connected!'});
        // });
        socket.on("timer status", function(msg){
          remain_second = msg.data;
          $("#timer").html(remain_second+" 초 후 업데이트");
        });

        // socket.on('gpu status', function(msg) {
        //             // $('#log').append('<br>' + $('<div/>').text('Received  : ' + msg.temp).html());
        //             $("#hash"+msg.cardNum).html(msg.hash+" MH/s");
        //             var parsedTemp = JSON.parse(msg.temp);
        //             for(var i=1; i<parsedTemp.length+1; i++){
        //               $('#gpu'+msg.cardNum+i).html(parsedTemp[i-1]);
        //             };
        //
        //             // tailScroll();
        //         });
        socket.on('miningpoolhub status', function(msg) {
          var total_num = msg.data.length + msg.data2.length;

          // Holder.addTheme("vine", {text: msg.data.length });
          // Holder.run();
          // console.log(msg.data.length);
          // // var parsedData = JSON.parse(msg.data);
          // console.log(msg.data);

          //ethereum
          var total_hash = 0;
          var miners_list = [];
          for(var miner in msg.data){
            // var minerNum = miner["username"].substring(13);
            var data = msg.data[miner];
            var minerNum = data["username"].substring(13);
            miners_list.push(minerNum);
            // console.log(minerNum);
            // console.log("hash"+minerNum);

            $('#hash'+minerNum).html((data["hashrate"]/1000).toFixed(1)+" MH/s").css("background-color","transparent");
            if(data["hashrate"] == 0) {
              total_num -= 1;
              $('#hash'+minerNum).css("background-color", "red");
            };
            total_hash += data["hashrate"]/1000000;
          };

          // console.log(miners_list);


          //ethereum classic
          for(var miner in msg.data2){
            var data = msg.data2[miner];
            var minerNum = data["username"].substring(13);

            $('#hashC'+minerNum).html((data["hashrate"]/1000).toFixed(1)+" MH/s").css("background-color","transparent");
            if(data["hashrate"] == 0) {
              total_num -= 1;
              $('#hashC'+minerNum).css("background-color", "red");
            };

            $('#total-hash').html(total_hash.toFixed(2)+" GH/s");
            $('#total-machines').html(total_num+" / 35");
            total_hash += data["hashrate"]/1000000;
          };

          // console.log(miners_list);
          for(var i in miners_list){
            var eth_color = $('#hash'+miners_list[i]).css("background-color");
            var classic_color = $("#hashC"+miners_list[i]).css("background-color");
            // console.log(miners_list[i]);
            // console.log(eth_color);
            // console.log(classic_color);
            // donsole.log()
            // console.log(eth_color != classic_color)
            // if(i == "1" ){
            //   console.log($('#hashC'+i).text());
            //   console.log(eth_color);
            //   console.log(classic_color);
            // };
            // if(i == "9" ){
            //   console.log($('#hashC'+i).text() == "");
            //   console.log(eth_color);
            //   console.log(classic_color);
            // };
            // if(i == "12" ){
            //   console.log(eth_color);
            //   console.log(classic_color);
            // };

            if (($('#hashC'+miners_list[i]).text() != "") && ($('#hash'+miners_list[i]).text() != "")){
              if((eth_color == "rgb(255, 0, 0)") && (eth_color != classic_color)){
                $('#hash'+miners_list[i]).css("background-color","transparent");
              }else if((classic_color == "rgb(255, 0, 0)") && (eth_color != classic_color)){
                $('#hashC'+miners_list[i]).css("background-color","transparent");
              };
            };
          };
          miners_list = [];

        });

        // $('#total-hash').html(total_hash.toFixed(2)+" GH/s");
        // $('#total-machines').html(total_num+" / 35");

      });

        // function tailScroll() {
        //     var height = $("#log").get(0).scrollHeight;
        //     $("#log").animate({
        //         scrollTop: height
        //     }, 500);
        // };



      // });
      </script>



<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200" preserveAspectRatio="none" style="visibility: hidden; position: absolute; top: -100%; left: -100%;"><defs></defs><text x="0" y="10" style="font-weight:bold;font-size:10pt;font-family:Arial, Helvetica, Open Sans, sans-serif;dominant-baseline:middle">200x200</text></svg>
{% endblock %}
